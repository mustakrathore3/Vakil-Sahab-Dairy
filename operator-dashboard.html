<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Operator Dashboard - Vakil Sahab Dairy</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
<style>
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  margin: 0;
  display: flex;
  overflow-x: hidden;
}
.sidebar {
  width: 250px;
  background-color: #1d4ed8;
  color: white;
  height: 100vh;
  position: fixed;
  top: 0;
  left: 0;
  padding-top: 20px;
  display: flex;
  flex-direction: column;
}
.sidebar a {
  color: #bbb;
  padding: 15px 20px;
  text-decoration: none;
  display: flex;
  align-items: center;
  gap: 15px;
  font-weight: 500;
  cursor: pointer;
  transition: background 0.3s, color 0.3s;
}
.sidebar a:hover,
.sidebar a.active {
  background-color: #2563eb;
  color: white;
}
.sidebar a i {
  font-size: 1.2rem;
}
.sidebar .logout-btn {
  margin-top: auto;
  font-weight: 700;
  background: #ef4444;
  text-align: center;
  cursor: pointer;
  padding: 12px 20px;
  border-radius: 0 30px 30px 0;
  color: white;
  transition: background 0.3s;
}
.sidebar .logout-btn:hover {
  background: #dc2626;
}
.main-content {
  margin-left: 250px;
  flex-grow: 1;
  padding: 20px 40px;
  overflow-y: auto;
  min-height: 100vh;
}
.content-header {
  color: #2563eb;
  font-size: 1.8rem;
  font-weight: bold;
  margin-bottom: 10px;
}
.welcome-text {
  color: #64748b;
  margin-bottom: 20px;
  font-weight: 600;
}
.content-section {
  background: white;
  padding: 20px;
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
  margin-bottom: 30px;
  min-height: 250px;
}
.hidden {
  display: none;
}
input[type='text'],
input[type='email'],
input[type='date'],
textarea,
select {
  width: 100%;
  padding: 6px 8px;
  margin-bottom: 10px;
  border: 1px solid #ccc;
  border-radius: 6px;
}
label {
  font-weight: 600;
  margin-bottom: 6px;
  display: block;
}
button.btn {
  margin-top: 10px;
}
.data-table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 15px;
}
.data-table th,
.data-table td {
  padding: 10px;
  border: 1px solid #ddd;
  text-align: left;
}
.data-table th {
  background-color: #ebf4ff;
  color: #2563eb;
}
</style>
</head>
<body>
<div class="sidebar">
  <a href="#" class="active" data-section="newcase"><i class="fas fa-file-signature"></i>New Case Entry</a>
  <a href="#" data-section="hearingcalendar"><i class="fas fa-calendar-alt"></i>Hearing Calendar</a>
  <a href="#" data-section="oldcasecorrection"><i class="fas fa-edit"></i>Old Case Entry Correction</a>
  <a href="#" data-section="filesearch"><i class="fas fa-search"></i>File Search</a>
  <div class="logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i>Logout</div>
</div>
<div class="main-content">
  <div class="content-header" id="userNameHeader">Welcome Operator</div>
  <div class="welcome-text" id="userEmailText"></div>

  <section class="content-section" id="newcase">
    <h3>New Case Entry</h3>
    <label>Main File Name:</label>
    <input type="text" id="fileName" placeholder="Main File Name" />
    <label>Client Name:</label>
    <input type="text" id="clientName" placeholder="Client Name" />
    <label>Client Mobile Number:</label>
    <input type="text" id="clientMobile" placeholder="Client Mobile Number" />
    <label>Village/Town:</label>
    <input type="text" id="clientVillage" placeholder="Village/Town" />
    <label>Court Name (Admin Set List):</label>
    <select id="courtNameSelect">
      <option value="">Select Court</option>
    </select>
    <label>Act / [translate:अधिनियम]:</label>
    <input type="text" id="actName" placeholder="Act / अधिनियम" />
    <label>New Case Number (optional):</label>
    <input type="text" id="newCaseNumber" placeholder="New Case Number" />
    <label>Old Case Number (optional):</label>
    <input type="text" id="oldCaseNumber" placeholder="Old Case Number" />
    <label>Current Stage:</label>
    <input type="text" id="currentStage" placeholder="Current Stage" />
    <!-- Document upload optional - not included now -->
    <button class="btn btn-primary" onclick="submitNewCase()">Submit New Case</button>
  </section>

  <section class="content-section hidden" id="hearingcalendar">
    <h3>Hearing Calendar</h3>
    <p>Auto populated hearing cases of selected date (coming soon)</p>
    <!-- Further hearing calendar UI and functionality to be added -->
  </section>

  <section class="content-section hidden" id="oldcasecorrection">
    <h3>Old Case Entry Correction</h3>
    <p>Search and modify past case entries (coming soon)</p>
  </section>

  <section class="content-section hidden" id="filesearch">
    <h3>File Search</h3>
    <label>Search by File name / Mobile number / Hearing date / Case number</label>
    <input type="text" id="fileSearchInput" placeholder="Enter search keyword..." />
    <button class="btn btn-primary" onclick="searchFiles()">Search</button>
    <div id="searchResults"></div>
  </section>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyBDr6dV5_I20NQK1UU-EVazfyW-KlM5oBI",
  authDomain: "vakilsahabdairy.firebaseapp.com",
  projectId: "vakilsahabdairy",
  storageBucket: "vakilsahabdairy.appspot.com",
  messagingSenderId: "8534746153",
  appId: "1:8534746153:web:4973290db36d4f21e52838"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
let currentUser = null;

const sidebarLinks = document.querySelectorAll('.sidebar a[data-section]');
const sections = document.querySelectorAll('.content-section');
sidebarLinks.forEach(link => {
  link.addEventListener('click', e => {
    e.preventDefault();
    sidebarLinks.forEach(l => l.classList.remove('active'));
    link.classList.add('active');
    const targetSection = link.getAttribute('data-section');
    sections.forEach(section =>
      section.id === targetSection ? section.classList.remove('hidden') : section.classList.add('hidden')
    );
  });
});

auth.onAuthStateChanged(user => {
  if (!user) {
    window.location.href = "/login.html"; // redirect to login page
  } else {
    currentUser = user;
    document.getElementById('userNameHeader').textContent = user.email;
    document.getElementById('userEmailText').textContent = "";
    loadCourtList();
  }
});

async function loadCourtList() {
  const courtSelect = document.getElementById('courtNameSelect');
  courtSelect.innerHTML = '<option value="">Select Court</option>';
  try {
    const snapshot = await db.collection('courts').get();
    snapshot.forEach(doc => {
      const c = doc.data();
      const option = document.createElement('option');
      option.value = c.name;
      option.textContent = c.name + " - " + c.tehsil;
      courtSelect.appendChild(option);
    });
  } catch (error) {
    alert("Unable to load courts: " + error.message);
  }
}

async function submitNewCase() {
  const fileName = document.getElementById('fileName').value.trim();
  const clientName = document.getElementById('clientName').value.trim();
  const clientMobile = document.getElementById('clientMobile').value.trim();
  const clientVillage = document.getElementById('clientVillage').value.trim();
  const courtName = document.getElementById('courtNameSelect').value;
  const actName = document.getElementById('actName').value.trim();
  const newCaseNumber = document.getElementById('newCaseNumber').value.trim();
  const oldCaseNumber = document.getElementById('oldCaseNumber').value.trim();
  const currentStage = document.getElementById('currentStage').value.trim();

  if(!fileName || !clientName || !clientMobile || !clientVillage || !courtName || !actName || !currentStage) {
    alert('Please fill all required fields!');
    return;
  }

  try {
    const caseId = await db.collection('cases').add({
      fileName,
      clientName,
      clientMobile,
      clientVillage,
      courtName,
      actName,
      newCaseNumber,
      oldCaseNumber,
      currentStage,
      createdAt: new Date().toISOString()
    });
    alert("New case added successfully!");
    clearNewCaseForm();
  } catch(error) {
    alert("Error adding case: " + error.message);
  }
}

function clearNewCaseForm() {
  document.getElementById('fileName').value = '';
  document.getElementById('clientName').value = '';
  document.getElementById('clientMobile').value = '';
  document.getElementById('clientVillage').value = '';
  document.getElementById('courtNameSelect').value = '';
  document.getElementById('actName').value = '';
  document.getElementById('newCaseNumber').value = '';
  document.getElementById('oldCaseNumber').value = '';
  document.getElementById('currentStage').value = '';
}

async function searchFiles() {
  const keyword = document.getElementById('fileSearchInput').value.trim().toLowerCase();
  if(!keyword) {
    alert('Please enter search keyword!');
    return;
  }
  const resultsDiv = document.getElementById('searchResults');
  resultsDiv.innerHTML = 'Searching...';
  try {
    const snapshot = await db.collection('cases').get();
    const matches = [];
    snapshot.forEach(doc => {
      const c = doc.data();
      if (
        (c.fileName && c.fileName.toLowerCase().includes(keyword)) ||
        (c.clientMobile && c.clientMobile.includes(keyword)) ||
        (c.nextHearingDate && c.nextHearingDate.includes(keyword)) ||
        (c.caseNumber && c.caseNumber.includes(keyword))
      ) {
        matches.push({ id: doc.id, data: c });
      }
    });
    if(matches.length === 0) {
      resultsDiv.innerHTML = 'No matching files found.';
    } else {
      let html = '<table class="data-table"><thead><tr><th>File Name</th><th>Client</th><th>Mobile</th><th>Court</th><th>Current Stage</th><th>Next Hearing</th></tr></thead><tbody>';
      matches.forEach((m) => {
        html += `<tr>
          <td>${m.data.fileName || ''}</td>
          <td>${m.data.clientName || ''}</td>
          <td>${m.data.clientMobile || ''}</td>
          <td>${m.data.courtName || ''}</td>
          <td>${m.data.currentStage || ''}</td>
          <td>${m.data.nextHearingDate || ''}</td>
        </tr>`;
      });
      html += '</tbody></table>';
      resultsDiv.innerHTML = html;
    }
  } catch(error) {
    resultsDiv.innerHTML = 'Error in search: ' + error.message;
  }
}

function logout() {
  auth.signOut().then(() => {
    window.location.href = "login.html";
  });
}
</script>
</body>
</html>
