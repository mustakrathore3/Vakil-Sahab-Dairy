<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operator Dashboard | Vakil Sahab Diary</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Placeholder for calendar if needed */
        .calendar-embed-small {
            height: 250px;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 15px;
        }
        /* New Form Styling */
        .new-case-form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .new-case-form-grid input, .new-case-form-grid select {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .form-message {
            grid-column: span 2;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
            display: none; /* Default hidden */
            font-weight: bold;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        
        /* Layout */
        .dashboard-container {
            display: flex;
        }
        .two-column-layout {
            display: flex;
            gap: 20px;
        }
        .main-panel {
            flex: 2;
        }
        .side-panel {
            flex: 1;
            /* Placeholder styles if you want a sidebar */
        }
        .cta-button.secondary, .cta-button.tertiary {
            background-color: #2980b9; 
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <aside class="sidebar">
            <div class="logo-area"><h2 class="logo-text">‚öñÔ∏è Vakil Sahab Diary</h2></div>
            <nav class="nav-links">
                <a href="#" class="active">‡§π‡•ã‡§Æ</a>
                <a href="#">‡§ï‡•á‡§∏ ‡§∏‡§∞‡•ç‡§ö</a>
                <a href="#">‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü‡•ç‡§∏</a>
                <a href="#">‡§ï‡•ç‡§≤‡§æ‡§á‡§Ç‡§ü ‡§™‡•ã‡§∞‡•ç‡§ü‡§≤ ‡§≤‡§ø‡§Ç‡§ï</a>
            </nav>
        </aside>

        <main class="main-content">
            <header class="main-header">
                <h1>‡§ë‡§™‡§∞‡•á‡§ü‡§∞ ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§° (Welcome, Sunil)</h1>
                <div class="user-info">
                    <span>Operator ID: OP-001</span>
                    <button class="logout-btn" onclick="location.href='index.html';">Log Out</button>
                </div>
            </header>

            <section class="quick-actions-bar">
                <!-- Button ab form ko show karega -->
                <button class="cta-button" onclick="document.getElementById('newCasePanel').style.display='block';">
                    + ‡§®‡§Ø‡•Ä ‡§ï‡•á‡§∏ ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä
                </button>
                <button class="cta-button secondary">
                    üìÜ ‡§Ö‡§ó‡§≤‡•á 7 ‡§¶‡§ø‡§®‡•ã‡§Ç ‡§ï‡•Ä ‡§∏‡•Å‡§®‡§µ‡§æ‡§à
                </button>
                <button class="cta-button tertiary">
                    ‚öôÔ∏è ‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤ ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏
                </button>
            </section>
            
            <!-- NEW CASE ENTRY FORM PANEL -->
            <div class="section-panel" id="newCasePanel" style="display:none;">
                <h2>‡§®‡§Ø‡•Ä ‡§ï‡•á‡§∏ ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä (Firebase ‡§Æ‡•á‡§Ç ‡§∏‡•Ä‡§ß‡§æ ‡§∏‡•á‡§µ)</h2>
                <div class="form-message" id="formMessage"></div>
                <form id="newCaseForm" class="new-case-form-grid">
                    <input type="text" name="fileName" placeholder="‡•û‡§æ‡§á‡§≤ ‡§ï‡§æ ‡§®‡§æ‡§Æ (e.g., Sharma V/S Gupta)" required>
                    <input type="text" name="clientMobile" placeholder="‡§ï‡•ç‡§≤‡§æ‡§á‡§Ç‡§ü ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ (e.g., 9876543210)" required>
                    <input type="text" name="caseNum" placeholder="‡§ï‡•á‡§∏ ‡§®‡§Ç‡§¨‡§∞ (e.g., WSD/1001/25)" required>
                    <input type="text" name="courtName" placeholder="‡§ï‡•ã‡§∞‡•ç‡§ü ‡§ï‡§æ ‡§®‡§æ‡§Æ" required>
                    <input type="date" name="nextHearing" title="‡§Ö‡§ó‡§≤‡•Ä ‡§∏‡•Å‡§®‡§µ‡§æ‡§à ‡§ï‡•Ä ‡§§‡§æ‡§∞‡•Ä‡§ñ" required>
                    <select name="currentStage" required>
                        <option value="">‡§ï‡•á‡§∏ ‡§ï‡•Ä ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§∏‡•ç‡§ü‡•á‡§ú ‡§ö‡•Å‡§®‡•á‡§Ç</option>
                        <option value="Notice">‡§®‡•ã‡§ü‡§ø‡§∏</option>
                        <option value="Evidence">‡§ó‡§µ‡§æ‡§π‡•Ä</option>
                        <option value="Final Arguments">‡§´‡§æ‡§á‡§®‡§≤ ‡§Ü‡§∞‡•ç‡§ó‡•Å‡§Æ‡•á‡§Ç‡§ü‡•ç‡§∏</option>
                        <option value="Decision">‡§®‡§ø‡§∞‡•ç‡§£‡§Ø</option>
                        <option value="Appeal">‡§Ö‡§™‡•Ä‡§≤</option>
                    </select>
                    <!-- Admin Notes and Approval for internal use -->
                    <textarea name="adminNotes" placeholder="‡§è‡§°‡§Æ‡§ø‡§® ‡§®‡•ã‡§ü‡•ç‡§∏ (Optional)" style="grid-column: span 2;"></textarea>
                    
                    <button type="submit" class="cta-button" style="grid-column: span 2; background-color: #27ae60;">
                        ‡§ï‡•á‡§∏ ‡§ï‡•ã ‡§°‡•á‡§ü‡§æ‡§¨‡•á‡§∏ ‡§Æ‡•á‡§Ç ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç
                    </button>
                </form>
            </div>
            <!-- END NEW CASE ENTRY FORM PANEL -->

            <div class="two-column-layout">
                <div class="main-panel">
                    <div class="section-panel">
                        <h2>‡§Ü‡§™‡§ï‡•á ‡§™‡•á‡§Ç‡§°‡§ø‡§Ç‡§ó ‡§ü‡§æ‡§∏‡•ç‡§ï (Demo)</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>Task</th>
                                    <th>Case ID</th>
                                    <th>Due Date</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>‡•û‡§æ‡§á‡§≤ 155 ‡§ï‡•Ä ‡§§‡•à‡§Ø‡§æ‡§∞‡•Ä</td>
                                    <td>WSD/155</td>
                                    <td>2025-10-20</td>
                                    <td><button class="action-btn pending">View/Complete</button></td>
                                </tr>
                                <!-- ... existing table rows ... -->
                            </tbody>
                        </table>
                    </div>

                    <div class="section-panel">
                        <h2>‡§Ü‡§ú ‡§ï‡•Ä ‡§∏‡•Å‡§®‡§µ‡§æ‡§à (Calendar)</h2>
                         <div class="calendar-embed-small">
                            <iframe src="https://calendar.google.com/calendar/embed?height=250&wkst=1&bgcolor=%23ffffff&ctz=Asia%2FKolkata&src=bXVzdGFrcmF0aG9yZTNAZ21haWwuY29t&color=%23039BE5&showTitle=0" style="border:none;" width="100%" height="250" frameborder="0" scrolling="no"></iframe>
                        </div>
                    </div>
                </div>

                <aside class="side-panel">
                    <!-- Placeholder for live case feed -->
                    <div class="section-panel">
                        <h2>‡§≤‡§æ‡§á‡§µ ‡§ï‡•á‡§∏ ‡§´‡•Ä‡§°</h2>
                        <div id="liveCaseFeed">
                            <p>‡§®‡§è ‡§ï‡•á‡§∏ ‡§Ø‡§π‡§æ‡§Å ‡§¶‡§ø‡§ñ‡•á‡§Ç‡§ó‡•á...</p>
                        </div>
                    </div>
                </aside>
            </div>
        </main>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        
        // ====================================================================
        // IMPORTANT: YAHAN APNA FIREBASE CONFIG OBJECT PASTE KAREIN
        // ====================================================================
        const firebaseConfig = {
          apiKey: "AIzaSyADjPHjZ3fP2XELYqOK2RgXSXOAi3jP4cA",
          authDomain: "vakil-sahab-dairy.firebaseapp.com",
          projectId: "vakil-sahab-dairy",
          storageBucket: "vakil-sahab-dairy.firebasestorage.app",
          messagingSenderId: "610580761933",
          appId: "1:610580761933:web:a2a631516b25063b1efb04"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        const form = document.getElementById('newCaseForm');
        const message = document.getElementById('formMessage');

        // ====================================================================
        // A. CASE SUBMISSION (Form Submit)
        // ====================================================================
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            message.style.display = 'none';
            
            const formData = new FormData(form);
            const data = {};
            // FormData object ko JSON mein badalna
            formData.forEach((value, key) => { data[key] = value; });

            // Data ko sahi format mein taiyar karna
            const newCaseData = {
                timestamp: new Date().toISOString(), // Submission ka time
                operatorId: data.operatorId || 'OP-001',
                fileName: data.fileName,
                clientMobile: data.clientMobile,
                caseNum: data.caseNum,
                courtName: data.courtName,
                nextHearing: data.nextHearing,
                currentStage: data.currentStage,
                adminNotes: data.adminNotes || '',
                isApproved: 'NO' // By default NO
            };

            try {
                const submitButton = form.querySelector('button[type="submit"]');
                submitButton.textContent = '‡§∏‡•á‡§µ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...';
                submitButton.disabled = true;

                // Firestore mein naya document jodna
                const docRef = await addDoc(collection(db, "cases"), newCaseData);

                message.textContent = `‚úÖ Success! ‡§ï‡•á‡§∏ ${newCaseData.caseNum} ‡§∏‡•á‡§µ ‡§π‡•ã ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§ Document ID: ${docRef.id}`;
                message.className = 'form-message success';
                message.style.display = 'block';
                form.reset();

            } catch (error) {
                console.error("Firebase Submission Error:", error);
                message.textContent = `‚ùå Error: ‡§°‡•á‡§ü‡§æ‡§¨‡•á‡§∏ ‡§Æ‡•á‡§Ç ‡§∏‡•á‡§µ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§™‡§æ‡§Ø‡§æ‡•§ Error: ${error.message}`;
                message.className = 'form-message error';
                style.display = 'block';
            } finally {
                const submitButton = form.querySelector('button[type="submit"]');
                submitButton.textContent = '‡§ï‡•á‡§∏ ‡§ï‡•ã ‡§°‡•á‡§ü‡§æ‡§¨‡•á‡§∏ ‡§Æ‡•á‡§Ç ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç';
                submitButton.disabled = false;
                
                setTimeout(() => {
                    message.style.display = 'none';
                    document.getElementById('newCasePanel').style.display = 'none';
                }, 5000);
            }
        });

        // ====================================================================
        // B. LIVE CASE FEED (Real-time Update)
        // ====================================================================
        const liveCaseFeed = document.getElementById('liveCaseFeed');
        
        // Firestore se real-time data read karna
        const q = query(collection(db, "cases")); // Saare cases ko fetch karna
        
        // onSnapshot Firestore ka magic hai - yeh real-time update karta hai!
        const unsubscribe = onSnapshot(q, (snapshot) => {
            let feedHTML = '<h3>‡§®‡§Ø‡•á ‡§ï‡•á‡§∏ ‡§ï‡•Ä ‡§∏‡•Ç‡§ö‡•Ä:</h3>';
            
            snapshot.forEach((doc) => {
                const data = doc.data();
                feedHTML += `
                    <div style="border-bottom: 1px solid #eee; padding: 10px 0;">
                        <p style="margin: 0;"><strong>‡•û‡§æ‡§á‡§≤:</strong> ${data.fileName}</p>
                        <p style="margin: 0; font-size: 0.9em;"><strong>‡§ï‡•á‡§∏ ‡§®‡§Ç:</strong> ${data.caseNum} | <strong>‡§∏‡•ç‡§ü‡•á‡§ú:</strong> <span style="color:#2980b9;">${data.currentStage}</span></p>
                        <p style="margin: 0; font-size: 0.8em; color: #777;">Added: ${new Date(data.timestamp).toLocaleDateString('hi-IN')}</p>
                    </div>
                `;
            });

            liveCaseFeed.innerHTML = feedHTML;
        }, (error) => {
            console.error("Error listening to Firestore:", error);
            liveCaseFeed.innerHTML = '<p style="color:red;">‡§°‡•á‡§ü‡§æ‡§¨‡•á‡§∏ ‡§ï‡§®‡•á‡§ï‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã ‡§™‡§æ‡§Ø‡§æ‡•§</p>';
        });

        // NOTE: Agar aap is page ko chhodte hain, toh aapko unsubscribe call karna chahiye.
        // window.addEventListener('beforeunload', unsubscribe);
    </script>
</body>
</html>
