<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Admin Dashboard - Vakil Sahab Dairy</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
<style>
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  margin:0;
  display:flex;
  overflow-x:hidden;
}
.sidebar {
  width: 250px;
  background-color: #1d4ed8;
  color: white;
  height: 100vh;
  position: fixed;
  top:0;
  left:0;
  padding-top: 20px;
  display: flex;
  flex-direction: column;
}
.sidebar a {
  color: #bbb;
  padding: 15px 20px;
  text-decoration:none;
  display: flex;
  align-items: center;
  gap: 15px;
  font-weight: 500;
  cursor:pointer;
  transition: background 0.3s, color 0.3s;
}
.sidebar a:hover, .sidebar a.active {
  background-color: #2563eb;
  color: white;
}
.sidebar a i {
  font-size: 1.2rem;
}
.sidebar .logout-btn {
  margin-top: auto;
  font-weight: 700;
  background: #ef4444;
  text-align: center;
  cursor: pointer;
  padding: 12px 20px;
  border-radius: 0 30px 30px 0;
  color: white;
  transition: background 0.3s;
}
.sidebar .logout-btn:hover {
  background: #dc2626;
}
.main-content {
  margin-left: 250px;
  flex-grow: 1;
  padding: 20px 40px;
  overflow-y: auto;
  min-height: 100vh;
}
.content-header {
  color: #2563eb;
  font-size: 1.8rem;
  font-weight: bold;
  margin-bottom: 10px;
}
.welcome-text {
  color: #64748b;
  margin-bottom: 20px;
  font-weight: 600;
}
.content-section {
  background: white;
  padding: 20px;
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.1);
  margin-bottom: 30px;
  min-height: 250px;
}
table.data-table {
  width: 100%;
  border-collapse: collapse;
}
table.data-table th, table.data-table td {
  padding: 10px;
  border: 1px solid #ddd;
  text-align: left;
}
table.data-table th {
  background-color: #ebf4ff;
  color: #2563eb;
}
.btn-primary, .btn-success, .btn-danger {
  margin-top: 12px;
}
.hidden { display:none; }
</style>
</head>
<body>
<div class="sidebar">
  <a href="#" class="active" data-section="dashboard"><i class="fas fa-home"></i>Dashboard</a>
  <a href="#" data-section="cases"><i class="fas fa-folder-open"></i>Cases</a>
  <a href="#" data-section="operators"><i class="fas fa-users"></i>Operators</a>
  <a href="#" data-section="clients"><i class="fas fa-user"></i>Clients</a>
  <a href="#" data-section="calendar"><i class="fas fa-calendar-alt"></i>Calendar</a>
  <a href="#" data-section="notifications"><i class="fas fa-bell"></i>Notifications</a>
  <a href="#" data-section="reports"><i class="fas fa-chart-line"></i>Reports</a>
  <a href="#" data-section="settings"><i class="fas fa-cog"></i>Settings</a>
  <div class="logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i>Logout</div>
</div>
<div class="main-content">
  <div class="content-header" id="userNameHeader">Welcome Admin</div>
  <div class="welcome-text" id="userEmailText"></div>
  <section class="content-section" id="dashboardSection">
    <h3>Dashboard Overview</h3>
    <p>Total cases: <span id="totalCasesCount">...</span></p>
    <p>Total clients: <span id="totalClientsCount">...</span></p>
    <p>Total operators: <span id="totalOperatorsCount">...</span></p>
    <p>Upcoming hearings: <span id="totalHearingsCount">...</span></p>
  </section>
  <section class="content-section hidden" id="casesSection">
    <h3>Cases Management</h3>
    <table class="data-table" id="casesTable">
      <thead>
        <tr>
          <th>Sno</th>
          <th>Case Number</th>
          <th>Client Name</th>
          <th>Mobile</th>
          <th>Court</th>
          <th>Current Stage</th>
          <th>Next Hearing</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <h4>Add New Case</h4>
    <div>
      <input type="text" id="caseClientName" placeholder="Client Name" />
      <input type="text" id="caseMobile" placeholder="Mobile" />
      <input type="text" id="caseCourt" placeholder="Court Name" />
      <input type="text" id="caseNumber" placeholder="Case Number" />
      <input type="text" id="caseCurrentStage" placeholder="Current Stage" />
      <input type="date" id="caseNextHearing" />
      <button class="btn btn-primary" onclick="addCase()">Add Case</button>
    </div>
    <!-- Edit Case Modal -->
    <div class="modal fade" id="editCaseModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header"><h5 class="modal-title">Edit Case</h5></div>
          <div class="modal-body">
            <input type="hidden" id="editCaseId" />
            <input type="text" class="form-control mt-2" id="editCaseClientName" placeholder="Client Name" />
            <input type="text" class="form-control mt-2" id="editCaseMobile" placeholder="Mobile" />
            <input type="text" class="form-control mt-2" id="editCaseCourt" placeholder="Court Name" />
            <input type="text" class="form-control mt-2" id="editCaseNumber" placeholder="Case Number" />
            <input type="text" class="form-control mt-2" id="editCaseCurrentStage" placeholder="Current Stage" />
            <input type="date" class="form-control mt-2" id="editCaseNextHearing" />
          </div>
          <div class="modal-footer">
            <button class="btn btn-primary" onclick="updateCase()">Update</button>
            <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          </div>
        </div>
      </div>
    </div>
  </section>
  <section class="content-section hidden" id="operatorsSection">
    <h3>Operators Management</h3>
    <table class="data-table" id="operatorsTable">
      <thead>
        <tr>
          <th>Sno</th>
          <th>Name</th>
          <th>Email</th>
          <th>Mobile</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <h4>Add New Operator</h4>
    <div>
      <input type="text" id="operatorName" placeholder="Name" />
      <input type="email" id="operatorEmail" placeholder="Email" />
      <input type="text" id="operatorMobile" placeholder="Mobile" />
      <button class="btn btn-primary" onclick="addOperator()">Add Operator</button>
    </div>
  </section>
  <section class="content-section hidden" id="clientsSection">
    <h3>Clients Management</h3>
    <table class="data-table" id="clientsTable">
      <thead>
        <tr>
          <th>Sno</th>
          <th>Name</th>
          <th>Email</th>
          <th>Mobile</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>
  <section class="content-section hidden" id="calendarSection">
    <h3>Calendar / Hearings</h3>
    <p>Feature will be added soon.</p>
  </section>
  <section class="content-section hidden" id="notificationsSection">
    <h3>Notifications</h3>
    <p>Feature will be added soon.</p>
  </section>
  <section class="content-section hidden" id="reportsSection">
    <h3>Reports & Statistics</h3>
    <p>Feature will be added soon.</p>
  </section>
  <section class="content-section hidden" id="settingsSection">
    <h3>Settings</h3>
    <p>Profile management coming soon.</p>
  </section>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyBDr6dV5_I20NQK1UU-EVazfyW-KlM5oBI",
  authDomain: "vakilsahabdairy.firebaseapp.com",
  projectId: "vakilsahabdairy",
  storageBucket: "vakilsahabdairy.firebasestorage.app",
  messagingSenderId: "8534746153",
  appId: "1:8534746153:web:4973290db36d4f21e52838"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
let currentUser = null;
const sidebarLinks = document.querySelectorAll('.sidebar a[data-section]');
const sections = document.querySelectorAll('.content-section');
sidebarLinks.forEach(link => {
  link.addEventListener('click', e => {
    e.preventDefault();
    sidebarLinks.forEach(l => l.classList.remove('active'));
    link.classList.add('active');
    const targetSection = link.getAttribute('data-section');
    sections.forEach(section =>
      section.id === targetSection + 'Section'
      ? section.classList.remove('hidden')
      : section.classList.add('hidden')
    );
  });
});
auth.onAuthStateChanged(user => {
  if (!user) {
    window.location.href = "login.html";
  } else {
    currentUser = user;
    document.getElementById('userNameHeader').textContent = user.displayName || user.email || 'Admin';
    document.getElementById('userEmailText').textContent = user.email || '';
    loadDashboardData();
  }
});
async function loadDashboardData() {
  const casesSnapshot = await db.collection('cases').get();
  const clientsSnapshot = await db.collection('clients').get();
  const operatorsSnapshot = await db.collection('operators').get();
  document.getElementById('totalCasesCount').textContent = casesSnapshot.size;
  document.getElementById('totalClientsCount').textContent = clientsSnapshot.size;
  document.getElementById('totalOperatorsCount').textContent = operatorsSnapshot.size;
  document.getElementById('totalHearingsCount').textContent = '---';
  loadCases();
  loadOperators();
  loadClients();
}
async function loadCases() {
  const tbody = document.querySelector('#casesTable tbody');
  tbody.innerHTML = '';
  const querySnapshot = await db.collection('cases').get();
  if (querySnapshot.empty) {
    tbody.innerHTML = '<tr><td colspan="8" class="text-center">No cases found.</td></tr>';
    return;
  }
  let sno = 1;
  querySnapshot.forEach(doc => {
    const c = doc.data();
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${sno++}</td>
      <td>${c.caseNumber || ''}</td>
      <td>${c.clientName || ''}</td>
      <td>${c.clientMobile || ''}</td>
      <td>${c.courtName || ''}</td>
      <td>${c.currentStage || ''}</td>
      <td>${c.nextHearingDate || ''}</td>
      <td>
        <button class="btn btn-sm btn-primary" onclick="editCase('${doc.id}')">Edit</button>
        <button class="btn btn-sm btn-danger" onclick="deleteCase('${doc.id}')">Delete</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}
async function addCase() {
  const name  = document.getElementById('caseClientName').value;
  const mobile = document.getElementById('caseMobile').value;
  const court = document.getElementById('caseCourt').value;
  const num = document.getElementById('caseNumber').value;
  const stage = document.getElementById('caseCurrentStage').value;
  const hearing = document.getElementById('caseNextHearing').value;
  if(!name || !mobile || !court || !num) {
    alert('Please fill all required case details!');
    return;
  }
  const newCase = {
    clientName: name, clientMobile: mobile, courtName: court,
    caseNumber: num, currentStage: stage, nextHearingDate: hearing,
    createdAt: new Date().toISOString()
  };
  try {
    await db.collection('cases').add(newCase);
    const clref = db.collection('clients');
    const q = await clref.where('mobile','==',mobile).get();
    if(q.empty) {
      await clref.add({ name: name, mobile: mobile, createdAt: new Date().toISOString() });
    }
    alert('Case and client saved!');
    clearCaseForm(); loadCases(); loadClients();
  } catch (error) {
    alert('Error: ' + error.message);
  }
}
function clearCaseForm() {
  document.getElementById('caseClientName').value = '';
  document.getElementById('caseMobile').value = '';
  document.getElementById('caseCourt').value = '';
  document.getElementById('caseNumber').value = '';
  document.getElementById('caseCurrentStage').value = '';
  document.getElementById('caseNextHearing').value = '';
}
async function editCase(caseId) {
  const doc = await db.collection('cases').doc(caseId).get();
  if (!doc.exists) return alert("Case not found!");
  const c = doc.data();
  document.getElementById('editCaseId').value = caseId;
  document.getElementById('editCaseClientName').value = c.clientName || "";
  document.getElementById('editCaseMobile').value = c.clientMobile || "";
  document.getElementById('editCaseCourt').value = c.courtName || "";
  document.getElementById('editCaseNumber').value = c.caseNumber || "";
  document.getElementById('editCaseCurrentStage').value = c.currentStage || "";
  document.getElementById('editCaseNextHearing').value = c.nextHearingDate || "";
  // Show modal
  var myModal = new bootstrap.Modal(document.getElementById('editCaseModal'));
  myModal.show();
}
async function updateCase() {
  const id = document.getElementById('editCaseId').value;
  const updated = {
    clientName: document.getElementById('editCaseClientName').value,
    clientMobile: document.getElementById('editCaseMobile').value,
    courtName: document.getElementById('editCaseCourt').value,
    caseNumber: document.getElementById('editCaseNumber').value,
    currentStage: document.getElementById('editCaseCurrentStage').value,
    nextHearingDate: document.getElementById('editCaseNextHearing').value,
  };
  try {
    await db.collection('cases').doc(id).update(updated);
    alert('Updated!');
    var myModalEl = document.getElementById('editCaseModal');
    var modal = bootstrap.Modal.getInstance(myModalEl)
    modal.hide();
    loadCases();
  } catch (error) {
    alert('Error: ' + error.message);
  }
}
async function deleteCase(caseId) {
  if(confirm('Delete this case?')) {
    try {
      await db.collection('cases').doc(caseId).delete();
      alert('Deleted!');
      loadCases();
    } catch(e) { alert('Error: '+e.message);}
  }
}
async function loadOperators() {
  const tbody = document.querySelector('#operatorsTable tbody');
  tbody.innerHTML = '';
  const snapshot = await db.collection('operators').get();
  if (snapshot.empty) {
    tbody.innerHTML = '<tr><td colspan="5" class="text-center">No operators found.</td></tr>';
    return;
  }
  let sno = 1;
  snapshot.forEach(doc => {
    const op = doc.data();
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${sno++}</td>
      <td>${op.name || ''}</td>
      <td>${op.email || ''}</td>
      <td>${op.mobile || ''}</td>
      <td>
        <button class="btn btn-sm btn-danger" onclick="deleteOperator('${doc.id}')">Delete</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}
async function addOperator() {
  const name = document.getElementById('operatorName').value;
  const email = document.getElementById('operatorEmail').value;
  const mobile = document.getElementById('operatorMobile').value;
  if(!name || !email || !mobile) { alert('Fill all operator details!'); return; }
  const newOp = { name, email, mobile, createdAt: new Date().toISOString() };
  try {
    await db.collection('operators').add(newOp);
    alert('Operator added!');
    clearOperatorForm(); loadOperators();
  } catch (error) {
    alert('Error: ' + error.message);
  }
}
function clearOperatorForm() {
  document.getElementById('operatorName').value = '';
  document.getElementById('operatorEmail').value = '';
  document.getElementById('operatorMobile').value = '';
}
async function deleteOperator(opId) {
  if(confirm('Delete this operator?')) {
    try {
      await db.collection('operators').doc(opId).delete();
      alert('Deleted!');
      loadOperators();
    } catch(e) { alert('Error: '+e.message);}
  }
}
async function loadClients() {
  const tbody = document.querySelector('#clientsTable tbody');
  tbody.innerHTML = '';
  const snapshot = await db.collection('clients').get();
  if (snapshot.empty) {
    tbody.innerHTML = '<tr><td colspan="5" class="text-center">No clients found.</td></tr>';
    return;
  }
  let sno = 1;
  snapshot.forEach(doc => {
    const cl = doc.data();
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${sno++}</td>
      <td>${cl.name || ''}</td>
      <td>${cl.email || ''}</td>
      <td>${cl.mobile || ''}</td>
      <td><button class="btn btn-sm btn-primary" onclick="alert('Client details soon!')">Details</button></td>
    `;
    tbody.appendChild(tr);
  });
}
function logout() {
  auth.signOut().then(() => {
    window.location.href = "login.html";
  });
}
</script>
</body>
</html>
